<!--views/admin/productos.ejs-->
<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
  <link rel="stylesheet" href="/stylesheets/style.css">
  <style>
    #exportMenu a {
      padding: 6px 12px;
      background-color: white;
      border: 1px solid #ccc;
      margin-bottom: 4px;
      display: block;
      width: 100px;
      text-align: center;
      text-decoration: none;
      color: #333;
    }
    #exportMenu a:hover {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>
  <h1><%= title %></h1>

  <p><a href="/admin/dashboard">‚Üê Volver al panel de administraci√≥n</a></p>

  <h2>Lista de productos</h2>

  <!-- üîΩ [EXPORTAR] –ö–Ω–æ–ø–∫–∞ —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º –º–µ–Ω—é -->
   <div style="margin-bottom: 20px; position: relative;">
    <button id="exportButton" class="btn btn-primary">Exportar</button>
    <div id="exportMenu" style="display: none; position: absolute; z-index: 10;">
      <a href="/admin/exportar-productos/csv" class="btn btn-outline-secondary btn-sm d-block">CSV</a>
      <a href="/admin/exportar-productos/pdf" class="btn btn-outline-secondary btn-sm d-block">PDF</a>
      <a href="/admin/exportar-productos/excel" class="btn btn-outline-secondary btn-sm d-block">Excel</a>
    </div>
  </div>
  
  <script>
  // üîΩ –°–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç/—Å–∫—Ä—ã–≤–∞–µ—Ç –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ
  const exportButton = document.getElementById('exportButton');
  const exportMenu = document.getElementById('exportMenu');

  exportButton.addEventListener('click', () => {
    exportMenu.style.display = exportMenu.style.display === 'none' ? 'block' : 'none';
  });

  // –ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
  document.addEventListener('click', function (event) {
    if (!exportButton.contains(event.target) && !exportMenu.contains(event.target)) {
      exportMenu.style.display = 'none';
    }
  });
  </script>

  <table border="1">
    <thead>
      <tr>
        <th>ID</th>
        <th>Imagen</th>
        <th>Nombre</th>
        <th>Descripci√≥n</th>
        <th style="text-align:right;">Precio (‚Ç¨)</th>
        <th>Stock</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <% productos.forEach(p => { %>
        <tr>
          <td><%= p.id %></td>
          <td>
            <% if (p.imagenUrl) { %>
              <img src="/uploads/productos/<%= p.imagenUrl %>" alt="Imagen de <%= p.nombre %>" width="100">
            <% } else { %>
              ‚Äî
            <% } %>
          </td>
          <td><%= p.nombre %></td>
          <td><%= p.descripcion || '‚Äî' %></td>
          <td>
            <% if (!isNaN(p.precioUnitario)) { %>
              <%= Number(p.precioUnitario).toFixed(2) %> ‚Ç¨
              <% } else { %>
                ‚Äî
              <% } %>
            </td>
            <td><%= p.stock || '‚Äî' %></td>
          <td>
            <a href="/admin/productos/editar/<%= p.id %>">‚úèÔ∏è Editar</a> |
            <form action="/admin/productos/eliminar/<%= p.id %>" method="POST" style="display:inline;">
              <button type="submit" onclick="return confirm('¬øEliminar este producto?')">üóëÔ∏è Eliminar</button>
            </form>
          </td>
        </tr>
      <% }); %>
    </tbody>
  </table>

  <h2>‚ûï A√±adir nuevo producto</h2>
  <form action="/admin/productos/nuevo" method="POST" enctype="multipart/form-data">
    <label>Imagen:</label>
    <input type="file" name="imagen" accept="image/*"><br>

    <label>Nombre:</label>
    <input type="text" name="nombre" required><br>

    <label>Descripci√≥n:</label>
    <input type="text" name="descripcion"><br>

    <label>Precio (‚Ç¨):</label>
    <input type="number" name="precio" step="0.01" required><br>

    <button type="submit">Crear producto</button>
  </form>
</body>
</html>